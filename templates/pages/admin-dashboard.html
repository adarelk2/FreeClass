<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>לוח בקרה - מנהל מערכת</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Lucide Icons CDN -->
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="min-h-screen bg-slate-100">

  <!-- Admin Header -->
  <header class="bg-slate-900 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
      <div class="flex items-center justify-between gap-4 flex-wrap">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-sky-600 flex items-center justify-center">
            <i data-lucide="settings" class="w-5 h-5"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold">לוח בקרה - מנהל מערכת</h1>
            <p class="text-sm text-slate-400">ניהול חדרים וחיישנים</p>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <a href="dashboard.html"
             class="inline-flex items-center gap-2 px-3 py-2 rounded-md border border-slate-600 text-slate-300 hover:bg-slate-800 transition text-sm">
            <i data-lucide="map-pin" class="w-4 h-4"></i>
            דשבורד סטודנטים
          </a>

          <a href="admin-login.html"
             class="inline-flex items-center gap-2 px-3 py-2 rounded-md hover:bg-slate-800 transition text-sm text-slate-300">
            <i data-lucide="log-out" class="w-4 h-4"></i>
            התנתק
          </a>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-6">

    <!-- Quick Stats -->
    <section class="grid grid-cols-2 lg:grid-cols-6 gap-4" id="statsGrid">
      <!-- injected by JS -->
    </section>

    <!-- Tabs -->
    <section class="w-full">
      <div class="bg-white shadow-sm p-1 rounded-xl inline-flex gap-1">
        <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition" data-tab="rooms">ניהול חדרים</button>
        <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition" data-tab="schedule">לוח שעות</button>
        <button class="tab-btn px-4 py-2 rounded-lg text-sm font-medium transition" data-tab="sensors">חיישנים</button>
      </div>

      <!-- Rooms Tab -->
      <div class="tab-panel mt-6" id="tab-rooms">
        <div class="bg-white rounded-xl shadow-sm">
          <div class="p-6 border-b border-slate-100">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
              <h2 class="text-lg font-semibold text-slate-800">ניהול סטטוס חדרים</h2>

              <div class="flex items-center gap-3">
                <div class="relative">
                  <i data-lucide="search" class="absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                  <input id="roomSearch"
                         placeholder="חיפוש חדר..."
                         class="h-10 w-64 pr-9 px-3 rounded-md border border-slate-200 bg-white
                                focus:outline-none focus:ring-2 focus:ring-sky-200" />
                </div>

                <button id="refreshBtn"
                        class="h-10 w-10 rounded-md border border-slate-200 bg-white hover:bg-slate-50 transition inline-flex items-center justify-center"
                        aria-label="Refresh">
                  <i data-lucide="refresh-cw" class="w-4 h-4 text-slate-700"></i>
                </button>
              </div>
            </div>
          </div>

          <div class="p-6 overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-slate-500 border-b">
                  <th class="text-right py-3">שם חדר</th>
                  <th class="text-right py-3">בניין</th>
                  <th class="text-right py-3">קומה</th>
                  <th class="text-right py-3">סטטוס נוכחי</th>
                  <th class="text-right py-3">שינוי סטטוס</th>
                </tr>
              </thead>
              <tbody id="roomsTbody" class="divide-y">
                <!-- injected by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Schedule Tab -->
      <div class="tab-panel mt-6 hidden" id="tab-schedule">
        <div class="bg-white rounded-xl shadow-sm">
          <div class="p-6 border-b border-slate-100">
            <h2 class="text-lg font-semibold text-slate-800">
              <i data-lucide="clock" class="w-5 h-5 inline ml-2 text-sky-600"></i>
              עריכת לוח שעות שבועי
            </h2>
          </div>

          <div class="p-6 space-y-3" id="scheduleList">
            <!-- injected by JS -->
          </div>
        </div>
      </div>

      <!-- Sensors Tab -->
      <div class="tab-panel mt-6 hidden" id="tab-sensors">
        <div class="bg-white rounded-xl shadow-sm">
          <div class="p-6 border-b border-slate-100">
            <h2 class="text-lg font-semibold text-slate-800">מצב חיישנים IoT</h2>
          </div>

          <div class="p-6 overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="text-slate-500 border-b">
                  <th class="text-right py-3">חדר</th>
                  <th class="text-right py-3">מיקום</th>
                  <th class="text-right py-3">מצב חיישן</th>
                  <th class="text-right py-3">עדכון אחרון</th>
                </tr>
              </thead>
              <tbody id="sensorsTbody" class="divide-y">
                <!-- injected by JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </section>

  </main>

  <script>
    // -----------------------------
    // Data (same as React)
    // -----------------------------
    const stats = {
      totalRooms: 55,
      availableRooms: 28,
      busyRooms: 22,
      maintenanceRooms: 5,
      activeSensors: 52,
      offlineSensors: 3,
    };

    let rooms = [
      { id: 1, name: 'כיתה 204', building: 'בניין הנדסה', floor: 2, status: 'available', sensorStatus: 'active', lastUpdate: '2 דקות' },
      { id: 2, name: 'חדר קריאה שקט 3', building: 'ספרייה מרכזית', floor: 2, status: 'available', sensorStatus: 'active', lastUpdate: '1 דקה' },
      { id: 3, name: 'מעבדת מחשבים 5', building: 'בניין הנדסה', floor: 1, status: 'busy', sensorStatus: 'offline', lastUpdate: '2 שעות' },
      { id: 4, name: 'כיתה 301', building: 'בניין מדעים', floor: 3, status: 'available', sensorStatus: 'active', lastUpdate: '30 שניות' },
      { id: 5, name: 'כיתה 102', building: 'בניין הנדסה', floor: 1, status: 'busy', sensorStatus: 'active', lastUpdate: '5 דקות' },
    ];

    let schedule = [
      { day: 'ראשון', open: '08:00', close: '22:00' },
      { day: 'שני', open: '08:00', close: '22:00' },
      { day: 'שלישי', open: '08:00', close: '22:00' },
      { day: 'רביעי', open: '08:00', close: '22:00' },
      { day: 'חמישי', open: '08:00', close: '20:00' },
      { day: 'שישי', open: '08:00', close: '14:00' },
      { day: 'שבת', open: 'סגור', close: 'סגור' },
    ];

    // edit mode by day string
    const editMode = {};

    // -----------------------------
    // Helpers
    // -----------------------------
    function badgeClass(status) {
      if (status === 'available') return 'bg-emerald-100 text-emerald-700';
      if (status === 'maintenance') return 'bg-amber-100 text-amber-700';
      return 'bg-red-100 text-red-700';
    }

    function statusLabel(status) {
      if (status === 'available') return 'פנוי';
      if (status === 'maintenance') return 'תחזוקה';
      return 'תפוס';
    }

    // -----------------------------
    // Render: Stats
    // -----------------------------
    function renderStats() {
      const grid = document.getElementById('statsGrid');

      const items = [
        { label: 'סה"כ חדרים', value: stats.totalRooms, valueClass: 'text-slate-800' },
        { label: 'פנויים', value: stats.availableRooms, valueClass: 'text-emerald-600' },
        { label: 'תפוסים', value: stats.busyRooms, valueClass: 'text-red-600' },
        { label: 'תחזוקה', value: stats.maintenanceRooms, valueClass: 'text-amber-600' },
        { label: 'חיישנים פעילים', value: stats.activeSensors, valueClass: 'text-sky-600' },
        { label: 'לא מקוונים', value: stats.offlineSensors, valueClass: 'text-red-600' },
      ];

      grid.innerHTML = items.map(i => `
        <div class="bg-white rounded-xl shadow-sm">
          <div class="p-4 text-center">
            <p class="text-sm text-slate-500">${i.label}</p>
            <p class="text-2xl font-bold ${i.valueClass}">${i.value}</p>
          </div>
        </div>
      `).join('');
    }

    // -----------------------------
    // Render: Rooms table
    // -----------------------------
    function renderRoomsTable() {
      const tbody = document.getElementById('roomsTbody');
      const q = (document.getElementById('roomSearch').value || '').trim();

      const filtered = rooms.filter(r => {
        if (!q) return true;
        return r.name.includes(q) || r.building.includes(q);
      });

      tbody.innerHTML = filtered.map(r => `
        <tr>
          <td class="py-3 font-medium text-slate-800">${r.name}</td>
          <td class="py-3 text-slate-500">${r.building}</td>
          <td class="py-3 text-slate-500">קומה ${r.floor}</td>
          <td class="py-3">
            <span class="${badgeClass(r.status)} inline-flex px-3 py-1 rounded-full text-xs font-medium">
              ${statusLabel(r.status)}
            </span>
          </td>
          <td class="py-3">
            <select
              class="h-10 w-32 rounded-md border border-slate-200 bg-white px-2
                     focus:outline-none focus:ring-2 focus:ring-sky-200"
              data-room-id="${r.id}"
            >
              <option value="available" ${r.status === 'available' ? 'selected' : ''}>פנוי</option>
              <option value="busy" ${r.status === 'busy' ? 'selected' : ''}>תפוס</option>
              <option value="maintenance" ${r.status === 'maintenance' ? 'selected' : ''}>תחזוקה</option>
            </select>
          </td>
        </tr>
      `).join('');

      // bind selects
      tbody.querySelectorAll('select[data-room-id]').forEach(sel => {
        sel.addEventListener('change', (e) => {
          const roomId = parseInt(e.target.getAttribute('data-room-id'), 10);
          const newStatus = e.target.value;
          rooms = rooms.map(rr => rr.id === roomId ? { ...rr, status: newStatus } : rr);
          renderRoomsTable();
          renderSensorsTable(); // reflect if you want consistency
        });
      });

      lucide.createIcons();
    }

    // -----------------------------
    // Render: Schedule
    // -----------------------------
    function renderSchedule() {
      const list = document.getElementById('scheduleList');

      list.innerHTML = schedule.map(d => {
        const isEditing = !!editMode[d.day];

        if (isEditing) {
          return `
            <div class="flex items-center gap-4 p-4 bg-slate-50 rounded-xl flex-wrap">
              <div class="w-24 font-semibold text-slate-800">${d.day}</div>

              <input type="time" value="${d.open}" data-day="${d.day}" data-field="open"
                     class="h-10 w-32 rounded-md border border-slate-200 bg-white px-3
                            focus:outline-none focus:ring-2 focus:ring-sky-200" />

              <span class="text-slate-500">עד</span>

              <input type="time" value="${d.close}" data-day="${d.day}" data-field="close"
                     class="h-10 w-32 rounded-md border border-slate-200 bg-white px-3
                            focus:outline-none focus:ring-2 focus:ring-sky-200" />

              <button class="h-10 px-3 rounded-md bg-emerald-600 text-white hover:bg-emerald-700 transition text-sm inline-flex items-center gap-2"
                      data-action="save" data-day="${d.day}">
                <i data-lucide="save" class="w-4 h-4"></i>
                שמור
              </button>
            </div>
          `;
        }

        return `
          <div class="flex items-center gap-4 p-4 bg-slate-50 rounded-xl flex-wrap">
            <div class="w-24 font-semibold text-slate-800">${d.day}</div>
            <div class="text-slate-600">${d.open} - ${d.close}</div>

            <button class="mr-auto h-10 px-3 rounded-md border border-slate-200 bg-white hover:bg-slate-100 transition text-sm inline-flex items-center gap-2"
                    data-action="edit" data-day="${d.day}">
              <i data-lucide="edit" class="w-4 h-4"></i>
              ערוך
            </button>
          </div>
        `;
      }).join('');

      // bind schedule actions
      list.querySelectorAll('button[data-action]').forEach(btn => {
        btn.addEventListener('click', () => {
          const day = btn.getAttribute('data-day');
          const action = btn.getAttribute('data-action');

          if (action === 'edit') {
            editMode[day] = true;
            renderSchedule();
          }

          if (action === 'save') {
            editMode[day] = false;
            renderSchedule();
          }
        });
      });

      // bind inputs
      list.querySelectorAll('input[data-day][data-field]').forEach(inp => {
        inp.addEventListener('input', (e) => {
          const day = e.target.getAttribute('data-day');
          const field = e.target.getAttribute('data-field');
          const value = e.target.value;

          schedule = schedule.map(s => s.day === day ? { ...s, [field]: value } : s);
        });
      });

      lucide.createIcons();
    }

    // -----------------------------
    // Render: Sensors table
    // -----------------------------
    function renderSensorsTable() {
      const tbody = document.getElementById('sensorsTbody');

      tbody.innerHTML = rooms.map(r => {
        const active = r.sensorStatus === 'active';

        return `
          <tr>
            <td class="py-3 font-medium text-slate-800">${r.name}</td>
            <td class="py-3 text-slate-500">${r.building} • קומה ${r.floor}</td>
            <td class="py-3">
              <div class="flex items-center gap-2">
                ${
                  active
                    ? `<i data-lucide="wifi" class="w-4 h-4 text-emerald-600"></i>
                       <span class="text-emerald-600 font-medium">פעיל</span>`
                    : `<i data-lucide="wifi-off" class="w-4 h-4 text-red-600"></i>
                       <span class="text-red-600 font-medium">לא מקוון</span>`
                }
              </div>
            </td>
            <td class="py-3 text-slate-500">${r.lastUpdate}</td>
          </tr>
        `;
      }).join('');

      lucide.createIcons();
    }

    // -----------------------------
    // Tabs
    // -----------------------------
    function setActiveTab(tabName) {
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.add('hidden'));
      document.getElementById(`tab-${tabName}`).classList.remove('hidden');

      document.querySelectorAll('.tab-btn').forEach(b => {
        const isActive = b.getAttribute('data-tab') === tabName;
        b.className = `tab-btn px-4 py-2 rounded-lg text-sm font-medium transition ${
          isActive ? 'bg-slate-900 text-white' : 'text-slate-700 hover:bg-slate-100'
        }`;
      });
    }

    // -----------------------------
    // Events
    // -----------------------------
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => setActiveTab(btn.getAttribute('data-tab')));
    });

    document.getElementById('roomSearch').addEventListener('input', renderRoomsTable);

    document.getElementById('refreshBtn').addEventListener('click', () => {
      // demo: just re-render, in real life fetch from backend
      renderStats();
      renderRoomsTable();
      renderSchedule();
      renderSensorsTable();
    });

    // -----------------------------
    // Boot
    // -----------------------------
    renderStats();
    renderRoomsTable();
    renderSchedule();
    renderSensorsTable();
    setActiveTab('rooms');
    lucide.createIcons();
  </script>
</body>
</html>
